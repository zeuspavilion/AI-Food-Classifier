<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Food Classifier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .upload-card { max-width: 500px; margin: 50px auto; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 30px; background: white; }
        #imagePreview { max-width: 100%; height: auto; border-radius: 10px; display: none; margin-top: 15px; }
        #loading { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="upload-card text-center">
        <h2 class="mb-3">üçï AI Food Classifier</h2>
        <p class="text-muted">Upload an image of food to see what the AI thinks it is!</p>
        
        <form id="uploadForm">
            <input class="form-control mb-3" type="file" id="fileInput" accept="image/png, image/jpeg, image/jpg" required>
            <img id="imagePreview" src="" alt="Image Preview">
            
            <button type="submit" class="btn btn-primary w-100 mt-3" id="predictBtn">Predict Food</button>
        </form>

        <div id="loading" class="mt-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 text-muted">AI is analyzing...</p>
        </div>

        <div id="resultBox" class="alert alert-success mt-4" style="display: none;">
            <h4 class="alert-heading">Result:</h4>
            <p id="predictionText" class="mb-0 fw-bold fs-5"></p>
        </div>

        <hr class="my-4">
        
        <a href="/history" class="btn btn-outline-secondary w-100">üìú View Prediction History</a>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const imagePreview = document.getElementById('imagePreview');
    const uploadForm = document.getElementById('uploadForm');
    const loading = document.getElementById('loading');
    const resultBox = document.getElementById('resultBox');
    const predictionText = document.getElementById('predictionText');
    const predictBtn = document.getElementById('predictBtn');

    // Show image preview when a file is selected
    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                resultBox.style.display = 'none'; // Hide old results
            }
            reader.readAsDataURL(file);
        }
    });

    // Handle form submission via AJAX (Fetch API)
    uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const file = fileInput.files[0];
        if (!file) return;

        // Prepare the data
        const formData = new FormData();
        formData.append('file', file);

        // UI Updates: Show loading, disable button
        predictBtn.disabled = true;
        loading.style.display = 'block';
        resultBox.style.display = 'none';

        try {
            // Send to our new REST API endpoint
            const response = await fetch('/predict', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            if (data.success) {
                predictionText.innerText = "üçΩÔ∏è " + data.prediction;
                resultBox.className = "alert alert-success mt-4";
            } else {
                predictionText.innerText = "‚ùå " + data.message;
                resultBox.className = "alert alert-danger mt-4";
            }
            resultBox.style.display = 'block';
        } catch (error) {
            predictionText.innerText = "‚ùå An error occurred connecting to the server.";
            resultBox.className = "alert alert-danger mt-4";
            resultBox.style.display = 'block';
        } finally {
            // UI Updates: Hide loading, enable button
            loading.style.display = 'none';
            predictBtn.disabled = false;
        }
    });
</script>

</body>
</html>